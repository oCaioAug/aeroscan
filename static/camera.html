<!-- Exemplo de página para configurar e visualizar a câmera do celular -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Configurar Câmera do Celular</title>
  <style>
      video { width: 100%; max-width: 400px; border: 1px solid #333; }
      select { margin-top: 10px; }
    </style>
  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
</head>
<body>
  <h2>Configurar Câmera do Celular</h2>
  <select id="cameraSelect"></select>
  <br>
  <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <div id="qrResult"></div>

  <script>
    const video = document.getElementById('video');
    const cameraSelect = document.getElementById('cameraSelect');
    let currentStream;

    // Lista as câmeras disponíveis
    async function getCameras() {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const cameras = devices.filter(device => device.kind === 'videoinput');
      cameraSelect.innerHTML = '';
      cameras.forEach((camera, idx) => {
        const option = document.createElement('option');
        option.value = camera.deviceId;
        option.text = camera.label || `Câmera ${idx + 1}`;
        cameraSelect.appendChild(option);
      });
    }

    // Inicia a câmera selecionada
    async function startCamera(deviceId) {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }
      const constraints = {
        video: { deviceId: deviceId ? { exact: deviceId } : undefined }
      };
      currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = currentStream;
    }

    cameraSelect.onchange = () => startCamera(cameraSelect.value);
  const canvas = document.getElementById('canvas');
  const qrResult = document.getElementById('qrResult');
  const ctx = canvas.getContext('2d');

  async function scanQRCodeAndBarcode() {
    if (!currentStream) return;
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // QR Code
    const code = jsQR(imageData.data, imageData.width, imageData.height);
    let qrText = code ? `QR Code detectado: ${code.data}` : '';

    // Barcode (usando QuaggaJS)
    Quagga.decodeSingle({
      src: canvas.toDataURL(),
      numOfWorkers: 0,
      inputStream: { size: 800 },
      decoder: {
        readers: [
          "code_128_reader",
          "ean_reader",
          "ean_8_reader",
          "code_39_reader",
          "code_39_vin_reader",
          "codabar_reader",
          "upc_reader",
          "upc_e_reader",
          "i2of5_reader",
          "2of5_reader",
          "code_93_reader"
        ]
      }
    }, function(result) {
      let barcodeText = '';
      if(result && result.codeResult) {
        barcodeText = `Código de Barra detectado: ${result.codeResult.code}`;
      } else {
        barcodeText = 'Nenhum Código de Barra detectado';
      }
      qrResult.innerText = [qrText, barcodeText].filter(Boolean).join('\n');
    });
  }

  // Escaneia a cada 1000ms
  setInterval(scanQRCodeAndBarcode, 1000);

    // Inicialização
    (async () => {
      await getCameras();
      if (cameraSelect.options.length > 0) {
        await startCamera(cameraSelect.value);
      }
    })();
  </script>
</body>
</html>